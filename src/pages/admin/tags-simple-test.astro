---
// Simple test page for TagsInput with tabs
import Layout from '../../layouts/AdminLayout.astro';
---

<Layout title="Tags Simple Test">
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <div class="container mx-auto px-4 py-8">
      <div class="max-w-4xl mx-auto">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
            Tags Input Simple Test
          </h1>

          <!-- Seed Data Controls -->
          <div class="mb-8 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
            <h2 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200 mb-3">
              üå± Test Backend Services
            </h2>
            <div class="flex gap-3">
              <button
                id="testPopularBtn"
                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors"
              >
                Test Popular Tags
              </button>
              <button
                id="testNewestBtn"
                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors"
              >
                Test Newest Tags
              </button>
              <button
                id="seedBtn"
                class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium transition-colors"
              >
                Seed Sample Tags
              </button>
              <div id="testStatus" class="flex items-center text-sm"></div>
            </div>
          </div>

          <!-- Results -->
          <div id="results" class="space-y-4"></div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Test popular tags
  document.getElementById('testPopularBtn')?.addEventListener('click', async () => {
    const status = document.getElementById('testStatus') as HTMLDivElement;
    const results = document.getElementById('results') as HTMLDivElement;
    
    status.innerHTML = '<span class="text-blue-600">‚è≥ Testing popular tags...</span>';

    try {
      const { TagsService } = await import('../../../backend');
      const result = await TagsService.getPopularTags(10);
      
      if (result.error) {
        status.innerHTML = '<span class="text-red-600">‚ùå Error: ' + result.error.message + '</span>';
        results.innerHTML = '<div class="p-4 bg-red-50 rounded-lg"><pre>' + JSON.stringify(result.error, null, 2) + '</pre></div>';
      } else {
        status.innerHTML = '<span class="text-green-600">‚úÖ Success!</span>';
        results.innerHTML = `
          <div class="p-4 bg-green-50 rounded-lg">
            <h3 class="font-semibold mb-2">Popular Tags (${result.data.length}):</h3>
            <div class="flex flex-wrap gap-2">
              ${result.data.map(tag => `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm">${tag}</span>`).join('')}
            </div>
          </div>
        `;
      }
    } catch (error: any) {
      status.innerHTML = '<span class="text-red-600">‚ùå Error: ' + error.message + '</span>';
      results.innerHTML = '<div class="p-4 bg-red-50 rounded-lg"><pre>' + error.stack + '</pre></div>';
    }
  });

  // Test newest tags
  document.getElementById('testNewestBtn')?.addEventListener('click', async () => {
    const status = document.getElementById('testStatus') as HTMLDivElement;
    const results = document.getElementById('results') as HTMLDivElement;
    
    status.innerHTML = '<span class="text-green-600">‚è≥ Testing newest tags...</span>';

    try {
      const { TagsService } = await import('../../../backend');
      const result = await TagsService.getNewestTags(10);
      
      if (result.error) {
        status.innerHTML = '<span class="text-red-600">‚ùå Error: ' + result.error.message + '</span>';
        results.innerHTML = '<div class="p-4 bg-red-50 rounded-lg"><pre>' + JSON.stringify(result.error, null, 2) + '</pre></div>';
      } else {
        status.innerHTML = '<span class="text-green-600">‚úÖ Success!</span>';
        results.innerHTML = `
          <div class="p-4 bg-green-50 rounded-lg">
            <h3 class="font-semibold mb-2">Newest Tags (${result.data.length}):</h3>
            <div class="flex flex-wrap gap-2">
              ${result.data.map(tag => `<span class="px-2 py-1 bg-green-100 text-green-800 rounded text-sm">${tag}</span>`).join('')}
            </div>
          </div>
        `;
      }
    } catch (error: any) {
      status.innerHTML = '<span class="text-red-600">‚ùå Error: ' + error.message + '</span>';
      results.innerHTML = '<div class="p-4 bg-red-50 rounded-lg"><pre>' + error.stack + '</pre></div>';
    }
  });

  // Seed sample tags
  document.getElementById('seedBtn')?.addEventListener('click', async () => {
    const btn = document.getElementById('seedBtn') as HTMLButtonElement;
    const status = document.getElementById('testStatus') as HTMLDivElement;
    const results = document.getElementById('results') as HTMLDivElement;
    
    btn.disabled = true;
    btn.textContent = 'Seeding...';
    status.innerHTML = '<span class="text-yellow-600">‚è≥ Seeding sample tags...</span>';

    try {
      const { TagsService } = await import('../../../backend');
      const result = await TagsService.seedSampleTags();
      
      if (result.success) {
        status.innerHTML = '<span class="text-green-600">‚úÖ Seed successful!</span>';
        results.innerHTML = '<div class="p-4 bg-green-50 rounded-lg">Sample tags created successfully!</div>';
      } else {
        status.innerHTML = '<span class="text-red-600">‚ùå Seed failed</span>';
        results.innerHTML = '<div class="p-4 bg-red-50 rounded-lg"><pre>' + JSON.stringify(result.error, null, 2) + '</pre></div>';
      }
    } catch (error: any) {
      status.innerHTML = '<span class="text-red-600">‚ùå Error: ' + error.message + '</span>';
      results.innerHTML = '<div class="p-4 bg-red-50 rounded-lg"><pre>' + error.stack + '</pre></div>';
    } finally {
      btn.disabled = false;
      btn.textContent = 'Seed Sample Tags';
    }
  });
</script>
