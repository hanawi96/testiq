---
// Test page để kiểm tra xung đột keyboard shortcuts
---

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test Keyboard Conflict Fix</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">⌨️ Test Keyboard Shortcuts Conflict Fix</h1>
    
    <!-- Problem Description -->
    <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold text-red-800 mb-4">🚨 Vấn đề đã được sửa</h2>
      <div class="space-y-3 text-red-700">
        <p><strong>Trước khi sửa:</strong></p>
        <ul class="list-disc list-inside ml-4 space-y-1">
          <li>Khi CongratulationsPopup hoặc TimeUpPopup hiển thị</li>
          <li>Nhập số tuổi (ví dụ: 23) vẫn kích hoạt chọn đáp án</li>
          <li>Số 2 → chọn đáp án B, số 3 → chọn đáp án C</li>
          <li>Gây xung đột và trải nghiệm người dùng kém</li>
        </ul>
      </div>
    </div>

    <!-- Solution -->
    <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold text-green-800 mb-4">✅ Giải pháp đã implement</h2>
      <div class="space-y-3 text-green-700">
        <p><strong>Sau khi sửa:</strong></p>
        <ul class="list-disc list-inside ml-4 space-y-1">
          <li>Keyboard shortcuts (phím 1-4) tự động vô hiệu hóa khi popup mở</li>
          <li>Người dùng có thể nhập tuổi bình thường mà không bị xung đột</li>
          <li>Keyboard shortcuts tự động kích hoạt lại khi popup đóng</li>
          <li>UI hiển thị trạng thái keyboard shortcuts (enabled/disabled)</li>
        </ul>
      </div>
    </div>

    <!-- Technical Changes -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold text-blue-800 mb-4">🔧 Thay đổi kỹ thuật</h2>
      <div class="space-y-4 text-blue-700">
        
        <div>
          <h3 class="font-semibold mb-2">1. IQTest.tsx</h3>
          <div class="bg-blue-100 p-3 rounded text-sm font-mono">
            <p>// Trước:</p>
            <p class="text-red-600">isActive: true</p>
            <p class="mt-2">// Sau:</p>
            <p class="text-green-600">isActive: !showCongratulationsPopup && !showTimeUpPopup && !showProgressPopup</p>
          </div>
        </div>

        <div>
          <h3 class="font-semibold mb-2">2. useIQKeyboardNavigation.ts</h3>
          <div class="bg-blue-100 p-3 rounded text-sm">
            <ul class="list-disc list-inside space-y-1">
              <li>Thêm logging để debug keyboard events</li>
              <li>Kiểm tra isActive trước khi xử lý phím</li>
              <li>Hiển thị trạng thái activation/deactivation</li>
            </ul>
          </div>
        </div>

        <div>
          <h3 class="font-semibold mb-2">3. IQNavigation.tsx</h3>
          <div class="bg-blue-100 p-3 rounded text-sm">
            <ul class="list-disc list-inside space-y-1">
              <li>Thêm prop isKeyboardDisabled</li>
              <li>Hiển thị thông báo khi keyboard shortcuts bị vô hiệu hóa</li>
              <li>Visual feedback cho người dùng</li>
            </ul>
          </div>
        </div>

      </div>
    </div>

    <!-- Test Instructions -->
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold text-yellow-800 mb-4">🧪 Hướng dẫn test</h2>
      <div class="space-y-3 text-yellow-700">
        <p><strong>Để test fix này:</strong></p>
        <ol class="list-decimal list-inside ml-4 space-y-2">
          <li>Truy cập trang IQ test: <code class="bg-yellow-100 px-2 py-1 rounded">/test/iq</code></li>
          <li>Làm bài test và hoàn thành (hoặc để hết thời gian)</li>
          <li>Khi CongratulationsPopup hoặc TimeUpPopup hiển thị:</li>
          <li class="ml-8">
            <ul class="list-disc list-inside space-y-1">
              <li>Thử nhập số tuổi (ví dụ: 23, 45, 67)</li>
              <li>Kiểm tra console log: phải thấy "Keyboard navigation disabled"</li>
              <li>Kiểm tra UI: phải thấy "Phím tắt tạm thời vô hiệu hóa"</li>
              <li>Đảm bảo không có đáp án nào được chọn khi nhập số</li>
            </ul>
          </li>
          <li>Sau khi đóng popup, keyboard shortcuts phải hoạt động lại bình thường</li>
        </ol>
      </div>
    </div>

    <!-- Console Logs to Watch -->
    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">📋 Console Logs cần chú ý</h2>
      <div class="space-y-3 text-gray-700">
        <div class="bg-gray-100 p-3 rounded font-mono text-sm">
          <p class="text-green-600">✅ Keyboard navigation activated - number keys 1-4 will select answers</p>
          <p class="text-red-600">🚫 Keyboard navigation disabled - popup is open or test inactive</p>
          <p class="text-orange-600">🚫 Keyboard navigation disabled - ignoring key: 2</p>
          <p class="text-blue-600">✅ Number 2 pressed - selecting answer: 1 (keyboard navigation active)</p>
        </div>
        <p><strong>Khi popup mở:</strong> Phải thấy logs "disabled" và "ignoring key"</p>
        <p><strong>Khi popup đóng:</strong> Phải thấy logs "activated" và "selecting answer"</p>
      </div>
    </div>

    <!-- Edge Cases -->
    <div class="bg-purple-50 border border-purple-200 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold text-purple-800 mb-4">🎯 Edge Cases đã xử lý</h2>
      <div class="space-y-3 text-purple-700">
        <ul class="list-disc list-inside ml-4 space-y-2">
          <li><strong>Multiple popups:</strong> Keyboard disabled khi bất kỳ popup nào mở</li>
          <li><strong>Popup transitions:</strong> State được sync ngay lập tức</li>
          <li><strong>Page refresh:</strong> Keyboard state được khôi phục đúng</li>
          <li><strong>Mobile devices:</strong> Touch input không bị ảnh hưởng</li>
          <li><strong>Accessibility:</strong> Screen readers vẫn hoạt động bình thường</li>
        </ul>
      </div>
    </div>

    <!-- Navigation -->
    <div class="text-center space-x-4">
      <a href="/test/iq" class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
        Test IQ (Kiểm tra fix)
      </a>
      <a href="/" class="inline-flex items-center px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
        Về trang chủ
      </a>
    </div>

    <!-- Footer -->
    <div class="mt-12 text-center text-sm text-gray-500">
      <p>🔧 Fix keyboard shortcuts conflict - Completed ✅</p>
      <p>Keyboard shortcuts (1-4) are now properly disabled when popups are open</p>
    </div>

  </div>
</body>
</html>
