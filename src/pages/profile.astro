---
// Redirect /profile to /u/username
// Lấy thông tin user hiện tại để redirect
let currentUser = null;
try {
  const { AuthService } = await import('../../backend');
  const authResponse = await AuthService.getCurrentUser();
  currentUser = authResponse.user;
} catch (error) {
  console.error('Error getting current user:', error);
}

if (currentUser) {
  // Redirect đến /u/username (dùng email làm username tạm thời)
  const username = currentUser.email?.split('@')[0] || 'user';
  return Astro.redirect(`/u/${username}`);
} else {
  // Chưa đăng nhập, redirect về trang chủ
  return Astro.redirect('/');
}
---