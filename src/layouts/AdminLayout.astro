---
export interface Props {
  title: string;
  description?: string;
}

const { title, description = "Admin Panel - IQ Test System" } = Astro.props;

import SEO from '../components/seo/SEO.astro';
import AdminSidebar from '../components/admin/layout/AdminSidebar.astro';
import AdminHeader from '../components/admin/layout/AdminHeader.astro';
---

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Dark mode script - th√™m tr∆∞·ªõc khi trang t·∫£i ƒë·ªÉ tr√°nh nh·∫•p nh√°y -->
  <script is:inline>
    // L·∫•y theme t·ª´ localStorage ho·∫∑c preferences
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const isDark = savedTheme === 'dark' || (!savedTheme && prefersDark);

    // √Åp d·ª•ng class dark n·∫øu c·∫ßn
    if (isDark) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  </script>

  <!-- Admin sidebar state pre-loading script - ch·∫°y tr∆∞·ªõc khi DOM render -->
  <script is:inline>
    // üéØ PROACTIVE: Pre-load sidebar state ƒë·ªÉ tr√°nh FOUC
    try {
      // ƒê·ªçc sidebar state t·ª´ localStorage
      const isCollapsed = localStorage.getItem('admin-sidebar-collapsed') === 'true';

      // ƒê·ªçc dropdown states
      const dropdownStates = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('dropdown-') && key.endsWith('-open')) {
          const dropdownId = key.replace('dropdown-', '').replace('-open', '');
          dropdownStates[dropdownId] = localStorage.getItem(key) === 'true';
        }
      }

      // Store states globally ƒë·ªÉ AdminSidebar component c√≥ th·ªÉ access
      window.__ADMIN_SIDEBAR_STATE__ = {
        isCollapsed,
        dropdownStates,
        preLoaded: true
      };

      console.log('üéØ Pre-loaded admin sidebar state:', window.__ADMIN_SIDEBAR_STATE__);

    } catch (error) {
      console.warn('‚ö†Ô∏è Failed to pre-load sidebar state:', error);
      // Fallback state
      window.__ADMIN_SIDEBAR_STATE__ = {
        isCollapsed: false,
        dropdownStates: {},
        preLoaded: false
      };
    }

    // üéØ PERFORMANCE: Temporarily disable transitions during initial load
    document.documentElement.classList.add('no-transitions');

    // Re-enable transitions after DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        document.documentElement.classList.remove('no-transitions');
        console.log('‚úÖ Transitions re-enabled after initial load');
      }, 100);
    });
  </script>

  <SEO
    title={`${title} - Admin`}
    description={description}
    noindex={true}
  />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen font-[Inter] overflow-hidden">

  <!-- Admin Layout Container -->
  <div id="admin-layout" class="flex h-screen">

    <!-- Sidebar -->
    <AdminSidebar currentPath={Astro.url.pathname} />

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col min-w-0 lg:pl-64 w-full">

      <!-- Header -->
      <AdminHeader title={title} />

      <!-- Main Content -->
      <main class="flex-1 overflow-y-auto bg-gray-50 dark:bg-gray-900 p-4 sm:p-6">
        <div class="w-full">
          <slot />
        </div>
      </main>

    </div>
  </div>


  <!-- Admin Layout Scripts -->
  <script>
    // Admin layout is now handled by Astro components
    // No additional JavaScript needed for basic functionality
    console.log('Admin layout initialized');
  </script>
</body>
</html> 